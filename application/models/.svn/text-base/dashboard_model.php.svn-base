<?php

/**
 * Description of bcast_model
 *
 * @author en3.webmaster@gmail.com
 */
class Dashboard_Model extends CI_Model {

	function __construct() {
        parent::__construct();
    }

    function get_all_dashboard_content(){
    	$data = array();

    	//count content type
    	$this->db->select('COUNT(id) AS ct_count');
    	$CCT = $this->db->get('dm_content_type')->row_array();
    	$data['content_type_count'] = $CCT['ct_count'];
    	// $CCT->free_result();

    	//count node content
    	$this->db->select('COUNT(id) AS nd_count');
    	$CN = $this->db->get('dm_node')->row_array();
    	$data['node_count'] = $CN['nd_count'];
    	// $CN->free_result();

    	//count users
    	$this->db->select('COUNT(USER_ID) AS user_count');
    	$CU = $this->db->get_where('bama_user', array('USER_STATUS'=>1))->row_array();
    	$data['active_user_count'] = $CU['user_count'];
    	// $CU->free_result();

    	return $data;
    }

    function buildTree(array $elements, $parentId = 0) {
        $branch = array();

        foreach ($elements as $element) {
            if ($element['parent'] == $parentId) {
                $children = $this->buildTree($elements, $element['id']);
                    if ($children) {
                        $element['children'] = $children;
                    }

                $branch[] = $element;
            }
        }

        return $branch;
    }

    function get_content_type_tree(){
        $tmpres = array();
        $result = array('total' => 0, 'items' => array());

        $this->db->select('id, parent, name AS text');
        $q = $this->db->get('dm_content_type');

        if($q->num_rows() >= 1){
            $result['total'] = $q->num_rows();            
            $result['items'] = $this->buildTree($q->result_array());
        }

        return $result;
    }

}//end of class